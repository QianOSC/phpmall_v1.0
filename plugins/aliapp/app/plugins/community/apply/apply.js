(my["webpackJsonp"]=my["webpackJsonp"]||[]).push([["plugins/community/apply/apply"],{"1d8f":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n,r=o(i("a34a")),a=i("2f62");function o(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return u(t)||c(t,e)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}function c(t,e){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)if(i.push(o.value),e&&i.length===e)break}catch(d){r=!0,a=d}finally{try{n||null==s["return"]||s["return"]()}finally{if(r)throw a}}return i}}function u(t){if(Array.isArray(t))return t}function l(t,e,i,n,r,a,o){try{var s=t[a](o),d=s.value}catch(c){return void i(c)}s.done?e(d):Promise.resolve(d).then(n,r)}function f(t){return function(){var e=this,i=arguments;return new Promise(function(n,r){var a=t.apply(e,i);function o(t){l(a,n,r,o,s,"next",t)}function s(t){l(a,n,r,o,s,"throw",t)}o(void 0)})}}function m(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function p(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?m(i,!0).forEach(function(e){h(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):m(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function h(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var v=function(){return i.e("components/page-component/app-area-picker/app-area-picker").then(i.bind(null,"8e44"))},y=function(){return i.e("plugins/community/components/app-head").then(i.bind(null,"d0d3"))},g=function(){return i.e("components/basic-component/app-textarea/app-textarea").then(i.bind(null,"47cb"))},b={data:function(){return{wait:!1,middleman:{status:99},id:null,form:{location:"",latitude:"",longitude:"",name:"",mobile:"",province_id:0,city_id:0,district_id:0,detail:""},location:"",setting:{middleman:""},is_refund_address:0,detail_url:"",list:[],submit_status:!1,automatic:"",province:[],focus:!1,address:!1}},computed:p({},(0,a.mapGetters)("mallConfig",{getTheme:"getTheme"}),{},(0,a.mapState)({community:function(t){return t.mallConfig.__wxapp_img.community},bonusImg:function(t){return t.mallConfig.__wxapp_img.bonus}})),components:{appAreaPicker:v,appTextArea:g,appHead:y},onLoad:function(t){t.id>0&&(this.address=!0),this.getPlace(),this.getStatus()},methods:(n={areaEvent:function(t){t&&(this.form.province_id=t.province.id,this.form.city_id=t.city.id,this.form.district_id=t.district.id)},toCommunity:function(){t.navigateTo({url:"/plugins/community/index/index"})},toIndex:function(){t.navigateTo({url:"/pages/index/index"})},reApply:function(){var t=this;t.middleman.status=-2},middlemanPay:function(){var e=this;if(e.id>0)return e.pay(e.id),!1;e.$request({url:e.$api.community.apply_pay,data:{id:e.middleman.id}}).then(function(i){0==i.code?e.pay(i.data.id):t.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(t){e.$hideLoading()})},getStatus:function(){var e=this;e.$request({url:e.$api.community.index}).then(function(i){e.$hideLoading(),0==i.code?(e.setting=i.data.setting,t.setNavigationBarTitle({title:"申请"+e.setting.middleman}),i.data.middleman.id>0?(e.middleman=i.data.middleman,e.address&&(e.middleman.status=-2,e.form=i.data.middleman,e.form.province==e.form.city?e.location=e.form.province+" "+e.form.district+" "+e.form.location:e.location=e.form.province+" "+e.form.city+" "+e.form.district+" "+e.form.location,t.setNavigationBarTitle({title:"填写"+e.setting.middleman+"信息"}))):e.middleman.status=-2):t.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(){e.$hideLoading()})},getPlace:function(){var e=this;e.$request({url:e.$api.city.cityName}).then(function(i){0===i.code?e.province=i.data.list:t.showToast({title:i.msg,icon:"none",duration:1e3})})},getChooseLocation:function(){var e=f(r.default.mark(function e(){var i,n,a,o,d,c,u,l,f,m,p,h;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(i=this,!i.address){e.next=3;break}return e.abrupt("return",!1);case 3:return e.next=5,t.chooseLocation();case 5:if(n=e.sent,a=s(n,2),o=a[0],d=a[1],!d){e.next=37;break}if(c="",u="",l="",f=d.name,"上海"==d.provinceName&&(d.provinceName="上海市"),"澳门特别行政区"!=d.provinceName&&"香港特别行政区"!=d.provinceName&&"台湾省"!=d.provinceName){e.next=18;break}return t.showToast({title:"不支持该地区",icon:"none"}),e.abrupt("return",!1);case 18:for(m in d.address=d.address.replace(d.provinceName,""),d.address=d.address.replace(d.cityName,""),d.address=d.address.replace(d.adName,""),f=d.name?d.name:d.address,d.address=d.provinceName+d.cityName+d.adName+f,d.adCode>0||(d.address="其他其他其他"),d.address||(d.address="其他其他其他"),d.address=d.address.replace("北京市北京市","北京市"),d.address=d.address.replace("天津市天津市","天津市"),d.address=d.address.replace("上海市上海市","上海市"),d.address=d.address.replace("重庆市重庆市","重庆市"),d.address=d.address.replace("香港特别行政区香港特别行政区","香港特别行政区"),d.address=d.address.replace("澳门特别行政区澳门特别行政区","澳门特别行政区"),i.province)if(0==d.address.indexOf(i.province[m].name))for(p in c="undefined"!=i.province[m].name?i.province[m].name:"",i.form.province_id=i.province[m].id,"北京市"!=c&&"天津市"!=c&&"上海市"!=c&&"重庆市"!=c&&"澳门特别行政区"!=c&&"香港特别行政区"!=c&&(d.address=d.address.replace(c,"")),i.province[m].list)if(0==d.address.indexOf(i.province[m].list[p].name)&&i.province[m].list[p].parent_id==i.province[m].id)for(h in u="undefined"!=i.province[m].list[p].name?i.province[m].list[p].name:"",i.form.city_id=i.province[m].list[p].id,d.address=d.address.replace(u,""),i.province[m].list[p].list)0==d.address.indexOf(i.province[m].list[p].list[h].name)&&i.province[m].list[p].list[h].parent_id==i.province[m].list[p].id&&i.province[m].list[p].list[h].provinceCode==i.province[m].code&&(l="undefined"!=i.province[m].list[p].list[h].name?i.province[m].list[p].list[h].name:"",i.form.district_id=i.province[m].list[p].list[h].id);c&&l&&f||(i.form.province_id="",i.form.city_id="",i.form.district_id=""),i.location=c==u?c+" "+l+" "+f:c+" "+u+" "+l+" "+f,i.form.location=f,i.form.latitude=d.latitude,i.form.longitude=d.longitude;case 37:o&&function(){t.showModal({title:"授权权限",content:"请先授权地理位置权限",success:function(e){e.confirm&&t.openSetting({success:function(e){e.authSetting["scope.userLocation"]?t.chooseLocation({success:function(t){i.getChooseLocation()}}):t.showToast({title:"授权失败",icon:"none"})}})}})};case 38:case"end":return e.stop()}},e,this)}));function i(){return e.apply(this,arguments)}return i}(),getInfo:function(e){var i=this;this.$request({url:this.$api.user.wechat_district,data:{province_name:e.address[0],city_name:e.address[1],county_name:e.address[2]}}).then(function(t){if(0===t.code){var n=t.data.district,r=n.province,a=n.city,o=n.district;e.province_id=r.id,e.city_id=a.id,e.district_id=o.id,i.form=e}}).catch(function(){t.showToast({title:"网络异常",icon:"none"})})}},h(n,"areaEvent",function(t){t&&(this.form.province_id=t.province.id,this.form.city_id=t.city.id,this.form.district_id=t.district.id,this.list=[t.province.name,t.city.name,t.district.name])}),h(n,"saveAddress",function(){var e=this;return this.form.detail&&this.form.province_id&&this.form.city_id&&this.form.district_id?void e.$request({url:e.$api.community.edit_address,data:{detail:e.form.detail},method:"post"}).then(function(e){t.showToast({title:e.msg,icon:"none",duration:1e3}),0==e.code&&setTimeout(function(){t.navigateBack({})},1e3)}).catch(function(t){e.$hideLoading()}):(t.showToast({title:"提货地址不能为空",icon:"none"}),!1)}),h(n,"submit",function(){var e=f(r.default.mark(function e(){var i,n,a,o,s,d,c,u,l,f,m;return r.default.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!this.submit_status){e.next=3;break}return e.abrupt("return");case 3:if(this.form.detail||(i="提货地址不能为空"),this.form.location||(i="所在地区不能为空"),this.form.mobile||(i="手机号不能为空"),this.form.name||(i="姓名不能为空"),!i){e.next=10;break}return t.showToast({title:i,icon:"none"}),e.abrupt("return");case 10:return this.submit_status=!0,n=this.$api.community.apply,a=this.form,this.is_refund_address>0&&(n=this.$api.app_admin.refund_address_edit,o=this.form,s=o.id,d=o.name,c=o.mobile,u=o.detail,a={form:JSON.stringify({id:s,name:d,mobile:c,address_detail:u,address:this.list,is_default:0,remark:""})}),e.next=16,this.$request({url:n,data:a,method:"POST"});case 16:l=e.sent,this.submit_status=!1,0===l.code?(f=l.data.queue_id,m=l.data.token,this.getResult(f,m)):t.showToast({title:l.msg,icon:"none"}),e.next=25;break;case 21:throw e.prev=21,e.t0=e["catch"](0),this.submit_status=!1,new Error(e.t0);case 25:case"end":return e.stop()}},e,this,[[0,21]])}));function i(){return e.apply(this,arguments)}return i}()),h(n,"getResult",function(e,i){var n=this;this.$request({url:this.$api.community.apply_result,data:{queue_id:e,token:i}}).then(function(r){0===r.code?r.data.retry&&1===r.data.retry?n.getPayDataTimer=setTimeout(function(){n.getResult(e,i)},1e3):(t.hideLoading(),r.data.id>0&&(n.id=r.data.id),n.getStatus()):(n.exchangeCoupon=!1,t.hideLoading(),t.showModal({title:"提示",content:r.msg,showCancel:!1}))}).catch(function(e){n.exchangeCoupon=!1,t.hideLoading(),t.showModal({title:"提示",content:e.errMsg,showCancel:!1})})}),h(n,"pay",function(e){var i=this;this.$payment.pay(e).then(function(t){i.getStatus()}).catch(function(){t.showToast({title:"支付失败",icon:"none",duration:1e3})})}),h(n,"detailFocus",function(){this.focus=!0}),n)};e.default=b}).call(this,i("c11b")["default"])},2461:function(t,e,i){"use strict";i.r(e);var n=i("e9fd"),r=i("51b6");for(var a in r)"default"!==a&&function(t){i.d(e,t,function(){return r[t]})}(a);i("dab08");var o=i("2877"),s=Object(o["a"])(r["default"],n["a"],n["b"],!1,null,"24e84671",null);e["default"]=s.exports},"51b6":function(t,e,i){"use strict";i.r(e);var n=i("1d8f"),r=i.n(n);for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);e["default"]=r.a},"836a":function(t,e,i){},dab08:function(t,e,i){"use strict";var n=i("836a"),r=i.n(n);r.a},e9fd:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement;t._self._c;t._isMounted||(t.e0=function(e){t.focus=!1})},r=[];i.d(e,"a",function(){return n}),i.d(e,"b",function(){return r})}},[["c031","common/runtime","common/vendor"]]]);