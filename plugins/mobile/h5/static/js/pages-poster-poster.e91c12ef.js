(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-poster-poster"],{"0997":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=r(n("a34a")),a=n("2f62");function r(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n,i,a,r,o){try{var s=t[r](o),c=s.value}catch(u){return void n(u)}s.done?e(c):Promise.resolve(c).then(i,a)}function s(t){return function(){var e=this,n=arguments;return new Promise(function(i,a){var r=t.apply(e,n);function s(t){o(r,i,a,s,c,"next",t)}function c(t){o(r,i,a,s,c,"throw",t)}s(void 0)})}}function c(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,i)}return n}function u(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?c(n,!0).forEach(function(e){d(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(n).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function d(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var f={data:function(){return{card_id:0,coupon_id:0,rpx:1,show:!1,info:{},canvas:null,dpr:2}},computed:u({},(0,a.mapGetters)("mallConfig",{getTheme:"getTheme"}),{},(0,a.mapState)({poster_img:function(t){return t.mallConfig.__wxapp_img.poster}})),methods:{imgLoad:function(t){return new Promise(function(e,n){uni.downloadFile({url:t,success:function(t){e(t.tempFilePath)},fail:function(t){n(2)}})})},createdImg:function(){var t=s(i.default.mark(function t(e,n,a,r,o,s,c,u){var d,f=arguments;return i.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return d=f.length>8&&void 0!==f[8]&&f[8],t.next=3,this.imgLoad(a).then(function(t){n.strokeStyle=u,n.save(),n.beginPath(),d&&(n.arc(s/2+r,c/2+o,s/2,0,2*Math.PI,!1),n.stroke(),n.clip()),n.drawImage(t,r,o,s,c),n.restore(),n.closePath()});case 3:case"end":return t.stop()}},t,this)}));function e(e,n,i,a,r,o,s,c){return t.apply(this,arguments)}return e}(),createdText:function(t,e,n,i,a,r,o,s){e.textAlign=o,e.font=r,e.fillStyle=s,e.fillText(n,i,a),e.stroke()},createdEllipse:function(t,e,n,i,a,r,o){var s=r/2,c=Math.abs(a-r);e.strokeStyle="rgba(0, 0, 0, 0)",e.save(),e.beginPath(),e.moveTo(n+s,i),e.lineTo(n+s+c,i),e.arcTo(n+a,i,n+a,i+s,s),e.arcTo(n+a,i+r,n+s+c,i+r,s),e.lineTo(n+s,i+r),e.arcTo(n,i+r,n,i+s,s),e.arcTo(n,i,n+s,i,s),e.stroke(),e.clip(),e.fillStyle=o,e.fill(),e.restore(),e.closePath()},created:function(){var t=s(i.default.mark(function t(e,n,a){var r,o,s,c,u,d,f,h,l,p;return i.default.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return r="#353535",o="sans-serif",t.next=4,this.createdImg(e,n,this.info.poster_bg,0,0,750*a,1334*a,"white",!1);case 4:return t.next=6,this.createdImg(e,n,this.info.avatar,310*a,66*a,130*a,130*a,"white",!0);case 6:if(this.createdText(e,n,this.info.nickname,376*a,252*a,28*a+"px "+o,"center","white"),!(this.card_id>0)){t.next=15;break}return t.next=10,this.createdImg(e,n,this.info.pic_url,76*a,394*a,120*a,120*a,"white",!0);case 10:s=this.info.name,c=33*a+"px "+o,s.length>20?(this.createdText(e,n,s.substring(0,10),220*a,439*a,c,"left",r),this.createdText(e,n,s.substring(11,20)+"...",220*a,490*a,c,"left",r)):s.length>10?(this.createdText(e,n,s.substring(0,10),220*a,439*a,c,"left",r),this.createdText(e,n,s.substring(11,s.length),220*a,490*a,c,"left",r)):this.createdText(e,n,s,220*a,465*a,c,"left",r),t.next=27;break;case 15:1===this.info.type?(this.createdText(e,n,this.info.discount,100*a,470*a,58*a+"px "+o,"left","white"),this.createdText(e,n,"折",185*a,470*a,33*a+"px "+o,"left","white")):(u=129,d=(this.info.sub_price+"").length,d>1&&(u-=15*(d-1)),this.createdText(e,n,"￥",u*a,470*a,33*a+"px "+o,"left","white"),this.createdText(e,n,this.info.sub_price,(u+30)*a,470*a,58*a+"px "+o,"left","white")),f="无门槛使用",this.info.min_price>0&&(f="满"+this.info.min_price+"可用"),this.createdText(e,n,f,286*a,439*a,33*a+"px "+o,"left",r),this.createdText(e,n,this.info.appoint_type,286*a,490*a,28*a+"px "+o,"left",r),h="",h=1==this.info.expire_type?"有效期：领取后".concat(this.info.expire_day,"天内有效"):"有效期：".concat(this.info.begin_time,"-").concat(this.info.end_time),l=parseInt(24*a),n.font=l+"px "+o,p=n.measureText(h).width,this.createdEllipse(e,n,(750*a-p)/2-l,882*a,p+48*a,60*a,"rgba(0, 0, 0, 0.2)"),this.createdText(e,n,h,375*a,920*a,l+"px "+o,"center","white");case 27:return t.next=29,this.createdImg(e,n,this.info.qrcode,255*a,964*a,240*a,240*a,"white",!0);case 29:return n.draw(),t.abrupt("return",null);case 31:case"end":return t.stop()}},t,this)}));function e(e,n,i){return t.apply(this,arguments)}return e}(),submitSave:function(){var t=this;t.$showLoading({text:"正在保存图片"}),uni.canvasToTempFilePath({canvas:t.canvas,canvasId:"poster",success:function(e){console.log(e),t.$request({url:t.$api.upload.file+"&name=base64",method:"post",data:{database:e.tempFilePath}}).then(function(e){0===e.code?(t.$utils.batchSave(e.data.url).then(function(){uni.showToast({title:"保存成功"})}),t.$hideLoading()):uni.showModal({title:"",content:e.msg,showCancel:!1})})}})},getList:function(){var t,e,n=this;n.card_id>0&&(t=n.$api.poster.card,e={cardId:n.card_id}),n.coupon_id>0&&(t=n.$api.poster.coupon,e={coupon_id:n.coupon_id}),n.$request({url:t,data:e}).then(function(t){0==t.code?(n.info=t.data,n.$hideLoading(),setTimeout(function(){var t=uni.createSelectorQuery();t.select("#poster").fields({node:!0,size:!0}).exec(function(t){var e=1;n.canvas=uni.createCanvasContext("poster");var i=n.canvas;i.scale(e,e),n.created(n.canvas,i,.4)})},100)):(n.$hideLoading(),uni.showToast({title:t.msg,icon:"none",duration:1e3}))}).catch(function(t){n.$hideLoading()})}},onLoad:function(t){var e=this;this.dpr=uni.getSystemInfoSync().pixelRatio,t.card_id>0&&(e.card_id=t.card_id),t.coupon_id>0&&(e.coupon_id=t.coupon_id),uni.getSystemInfo({success:function(t){e.rpx=t.windowWidth/375}}),e.$showLoading({text:"生成中"}),e.getList()}};e.default=f},"34bd":function(t,e,n){"use strict";n.r(e);var i=n("0997"),a=n.n(i);for(var r in i)"default"!==r&&function(t){n.d(e,t,function(){return i[t]})}(r);e["default"]=a.a},"5a25":function(t,e,n){var i=n("e60b");"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var a=n("4f06").default;a("383b9796",i,!0,{sourceMap:!1,shadowMode:!1})},7286:function(t,e,n){"use strict";n.r(e);var i=n("a728"),a=n("34bd");for(var r in a)"default"!==r&&function(t){n.d(e,t,function(){return a[t]})}(r);n("b877");var o=n("2877"),s=Object(o["a"])(a["default"],i["a"],i["b"],!1,null,"3623bb3e",null);e["default"]=s.exports},a728:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("app-layout",[n("v-uni-view",{staticClass:"poster"},[n("v-uni-view",{staticClass:"head",attrs:{id:"head"}},[n("v-uni-view",{staticClass:"main-center cross-center"},[n("v-uni-canvas",{staticStyle:{width:"300px",height:"533.6px"},attrs:{"canvas-id":"poster",id:"poster",width:300*t.dpr,height:533.6*t.dpr}})],1)],1),n("v-uni-view",{staticClass:"button main-center cross-center",class:t.getTheme+"-m-back "+t.getTheme,on:{click:function(e){e=t.$handleEvent(e),t.submitSave(e)}}},[t._v("保存图片")])],1)],1)},a=[];n.d(e,"a",function(){return i}),n.d(e,"b",function(){return a})},b877:function(t,e,n){"use strict";var i=n("5a25"),a=n.n(i);a.a},e60b:function(t,e,n){e=t.exports=n("2350")(!1),e.push([t.i,".text-center[data-v-3623bb3e]{text-align:center}.font-weight[data-v-3623bb3e]{font-weight:700}.page-width[data-v-3623bb3e]{width:100%}.goods-hover-class[data-v-3623bb3e]{opacity:.9;background-color:#f7f7f7}.background-image[data-v-3623bb3e]{background-repeat:no-repeat;background-size:100% 100%;background-position:50%}uni-page-body[data-v-3623bb3e]{font-size:%?32?%;background:#f7f7f7}.page-width[data-v-3623bb3e]{width:100%}.u-hover-class[data-v-3623bb3e]{opacity:.9;background-color:#f7f7f7}.safe-area-inset-bottom[data-v-3623bb3e]{padding-bottom:0;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}.poster .poster[data-v-3623bb3e]{width:%?1500?%;height:%?2668?%;position:fixed;left:100%;top:150%}.poster .head[data-v-3623bb3e]{width:100%}.poster .head uni-view[data-v-3623bb3e]{margin:%?50?% auto}.poster .button[data-v-3623bb3e]{font-size:%?32?%;border-radius:%?40?%;height:%?68?%;margin:0 auto %?50?%;color:#fff;width:%?500?%}body.?%PAGE?%[data-v-3623bb3e]{background:#f7f7f7}",""])}}]);