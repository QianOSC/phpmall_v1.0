(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["plugins-vip_card-buy-buy"],{"02a4":function(t,i,e){"use strict";e.r(i);var a=e("deb5"),n=e.n(a);for(var o in a)"default"!==o&&function(t){e.d(i,t,function(){return a[t]})}(o);i["default"]=n.a},"2df1":function(t,i,e){var a=e("ae24");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=e("4f06").default;n("421e9d96",a,!0,{sourceMap:!1,shadowMode:!1})},"2e07":function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var a=e("2f62"),n=o(e("6244"));function o(t){return t&&t.__esModule?t:{default:t}}function c(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);i&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,a)}return e}function r(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?c(e,!0).forEach(function(i){s(t,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):c(e).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})}return t}function s(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}var d={name:"app-close",components:{uMask:n.default},props:{modal:{type:Boolean,default:function(){return!0}},toBack:{type:Boolean,default:function(){return!1}},mch_id:{type:[Number,String],default:function(){return 0}},mch_list:{type:String,default:function(){return""}}},data:function(){return{mallStatus:{is_open:0,auto_open_text:""},isMall:!0,list:""}},created:function(){var t=this,i={},e="";this.mch_list&&(e=JSON.parse(this.mch_list),e.length>0&&(i.mch_id_list=e,-1==e.indexOf(0)&&(this.isMall=!1))),this.mch_id>0&&(i.mch_id_list=JSON.stringify([this.mch_id]),this.isMall=!1),this.$request({url:this.$api.index.status,data:i}).then(function(i){i.data;if(t.isMall||i.data.shift(),t.mallStatus=i.data[0],t.mch_id>0){var a=!0,n=!1,o=void 0;try{for(var c,r=i.data[Symbol.iterator]();!(a=(c=r.next()).done);a=!0){var s=c.value;s.mch_id==t.mch_id&&(t.mallStatus=s)}}catch(p){n=!0,o=p}finally{try{a||null==r.return||r.return()}finally{if(n)throw o}}}if(e.length>0){t.list="";var d=!0,l=!1,u=void 0;try{for(var g,f=i.data[Symbol.iterator]();!(d=(g=f.next()).done);d=!0){var v=g.value;2==v.is_open&&(t.mallStatus.auto_open_text||(t.mallStatus.auto_open_text=v.auto_open_text),t.mallStatus.is_open=v.is_open,t.list.length>0&&(t.list+="、"),t.list+=v.name)}}catch(p){l=!0,u=p}finally{try{d||null==f.return||f.return()}finally{if(l)throw u}}t.$emit("update",t.mallStatus)}else t.$emit("update",t.mallStatus)})},computed:r({},(0,a.mapGetters)("mallConfig",{getTheme:"getTheme"}),{},(0,a.mapState)({mall:function(t){return t.mallConfig.mall},userInfo:function(t){return t.user.info}})),methods:{toIndex:function(){this.toBack?uni.navigateBack():uni.redirectTo({url:"/pages/index/index"})}}};i.default=d},"5a20":function(t,i,e){"use strict";e.r(i);var a=e("2e07"),n=e.n(a);for(var o in a)"default"!==o&&function(t){e.d(i,t,function(){return a[t]})}(o);i["default"]=n.a},"75bd":function(t,i,e){"use strict";var a=e("2df1"),n=e.n(a);n.a},9700:function(t,i,e){"use strict";e.r(i);var a=e("bd2d"),n=e("02a4");for(var o in n)"default"!==o&&function(t){e.d(i,t,function(){return n[t]})}(o);e("dcaf");var c=e("2877"),r=Object(c["a"])(n["default"],a["a"],a["b"],!1,null,"27dcc781",null);i["default"]=r.exports},ae24:function(t,i,e){i=t.exports=e("2350")(!1),i.push([t.i,".text-center[data-v-5748c878]{text-align:center}.font-weight[data-v-5748c878]{font-weight:700}.page-width[data-v-5748c878]{width:100%}.goods-hover-class[data-v-5748c878]{opacity:.9;background-color:#f7f7f7}.background-image[data-v-5748c878]{background-repeat:no-repeat;background-size:100% 100%;background-position:50%}uni-page-body[data-v-5748c878]{font-size:%?32?%;background:#f7f7f7}.page-width[data-v-5748c878]{width:100%}.u-hover-class[data-v-5748c878]{opacity:.9;background-color:#f7f7f7}.safe-area-inset-bottom[data-v-5748c878]{padding-bottom:0;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}.close-tip[data-v-5748c878]{position:fixed;bottom:0;left:0;height:%?130?%;width:100%;z-index:20;font-size:%?30?%;color:#353535;background-color:#fff7d7}.close-tip uni-image[data-v-5748c878]{width:%?70?%;height:%?70?%;margin:0 %?24?%}.close-tip .close-content[data-v-5748c878]{padding-top:%?10?%;font-size:%?24?%;color:#999}.open-dialog[data-v-5748c878]{width:%?620?%;border-radius:%?16?%;background-color:#fff;position:relative;padding-top:%?40?%;padding-bottom:%?105?%;font-size:%?32?%;color:#353535;text-align:center}.open-dialog .open-dialog-content[data-v-5748c878]{padding:%?25?% 0;font-size:%?26?%;color:#666}.open-dialog .open-dialog-content uni-view[data-v-5748c878]{margin:%?5?% 0}.open-dialog .dialog-button[data-v-5748c878]{font-size:%?30?%;position:absolute;bottom:0;left:0;border-top:%?2?% solid #e2e2e2;height:%?90?%;line-height:%?90?%;width:100%}body.?%PAGE?%[data-v-5748c878]{background:#f7f7f7}",""])},bd2d:function(t,i,e){"use strict";var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("app-layout",[e("v-uni-view",{staticClass:"head-card",style:[{"background-color":""+t.list.form.card_bg}]},[e("v-uni-image",{staticClass:"card-bottom",attrs:{src:t.svipImg.card_bottom,alt:""}})],1),e("v-uni-view",{staticClass:"list"},[e("v-uni-view",{staticClass:"title main-center cross-center"},[e("v-uni-image",{attrs:{src:t.svipImg.left,alt:""}}),e("v-uni-view",{staticClass:"title-text"},[t._v("购买会员")]),e("v-uni-image",{attrs:{src:t.svipImg.right,alt:""}})],1),e("v-uni-view",{staticClass:"item dir-left-nowrap",staticStyle:{"border-top":"0"}},[e("v-uni-view",{staticClass:"label"},[t._v("超级会员卡名称")]),e("v-uni-view",{staticClass:"content"},[t._v(t._s(t.list.name))])],1),e("v-uni-view",{staticClass:"item dir-left-nowrap"},[e("v-uni-view",{staticClass:"label"},[t._v("会员卡标题")]),e("v-uni-view",{staticClass:"content"},[t._v(t._s(t.card.name))])],1),e("v-uni-view",{staticClass:"item dir-left-nowrap"},[e("v-uni-view",{staticClass:"label"},[t._v("有效时间")]),e("v-uni-view",{staticClass:"content"},[t._v(t._s(t.end_time>0?t.end_time:t.today)+"-"+t._s(t.end_day))])],1),e("v-uni-view",{staticClass:"item dir-left-nowrap"},[e("v-uni-view",{staticClass:"label"},[t._v("有效期")]),e("v-uni-view",{staticClass:"content"},[t._v(t._s(t.card.expire_day)+"天")])],1),e("v-uni-view",{staticClass:"item dir-left-nowrap"},[e("v-uni-view",{staticClass:"label"},[t._v("会员卡权益")]),t.card.main?e("v-uni-view",{staticClass:"content cross-center main-between"},[e("v-uni-view",{staticStyle:{"min-width":"70%"}},[1==t.card.main.is_free_delivery?e("v-uni-view",[t._v("自营商品包邮")]):t._e(),t.card.main.is_discount&&t.card.type_info.all?e("v-uni-view",[e("v-uni-text",[t._v("自营商品"+t._s(0==t.card.main.discount?"免费":t.card.main.discount+"折"))]),t.card&&t.card.type_info.ignore_goods&&t.card.type_info.ignore_goods.length>0||t.card&&t.card.type_info.ignore_cats&&t.card.type_info.ignore_cats.length>0?e("v-uni-text",{staticClass:"about"},[t._v("(特殊商品除外)")]):t._e()],1):t._e(),t.card&&t.card.main.is_discount&&t.card.type_info.cats&&t.card.type_info.cats.length>0?e("v-uni-view",[t._v("指定分类"+t._s(0==t.card.main.discount?"免费":t.card.main.discount+"折"))]):t._e(),t.card&&t.card.main.is_discount&&t.card.type_info.goods&&t.card.type_info.goods.length>0?e("v-uni-view",[t._v("指定商品"+t._s(0==t.card.main.discount?"免费":t.card.main.discount+"折"))]):t._e()],1),e("v-uni-view",{staticClass:"to-detail main-center cross-center",on:{click:function(i){i=t.$handleEvent(i),t.toDetail(i)}}},[e("v-uni-view",[t._v("详情")]),e("v-uni-image",{attrs:{src:"/static/image/icon/arrow-right.png"}})],1)],1):t._e()],1),t.card.send_integral_num>0||t.card.send_balance>0||t.card.coupons&&t.card.coupons.length>0||t.card.cards&&t.card.cards.length>0?e("v-uni-view",{staticClass:"item dir-left-nowrap"},[e("v-uni-view",{staticClass:"label"},[t._v("购买即赠")]),e("v-uni-view",{staticClass:"content"},[t.card.send_integral_num>0?e("v-uni-view",[t._v("积分"+t._s(t.card.send_integral_num))]):t._e(),t.card.send_balance>0?e("v-uni-view",[t._v("余额"+t._s(t.card.send_balance))]):t._e(),t._l(t.card.coupons,function(i){return t.card.coupons.length>0?e("v-uni-view",{key:i.id},[t._v(t._s(i.name)+"优惠券"+t._s(i.send_num)+"张")]):t._e()}),t._l(t.card.cards,function(i){return t.card.cards.length>0?e("v-uni-view",{key:i.id},[t._v(t._s(i.name)+"卡券"+t._s(i.send_num)+"张")]):t._e()})],2)],1):t._e()],1),t.list.order_form&&1===t.list.is_order_form?e("v-uni-view",{staticClass:"buy-form"},[e("app-diy-form",{attrs:{"label-position":"top","show-required-icon":!0,"label-fs28":!0,list:t.list.order_form},on:{validate:function(i){i=t.$handleEvent(i),t.handleOrderFormValidate(i)},input:function(i){i=t.$handleEvent(i),t.handleGoodsFormInput(i)}}})],1):t._e(),e("v-uni-view",{class:["bottom-place",t.iphone_x?"iphone_x":""]}),e("v-uni-view",{class:["foot",t.iphone_x?"iphone_x":""]},[e("v-uni-view",{staticClass:"foot-button",on:{click:function(i){i=t.$handleEvent(i),t.showClose=!0}}},[t._v("支付")])],1),t.success?e("v-uni-view",{staticClass:"dialog main-center cross-center"},[e("v-uni-view",{staticClass:"gift"},[e("v-uni-image",{staticClass:"gift-bg",attrs:{src:"./../image/gift.png"}}),e("v-uni-view",{staticClass:"gift-list"},[t.card.send_integral_num>0?e("v-uni-view",{staticClass:"gift-item",on:{click:function(i){i=t.$handleEvent(i),t.toIntegral(i)}}},[e("v-uni-image",{staticClass:"gift-icon",attrs:{src:"statics/img/app/vip_card/integral.png"!=t.list.form.integral_icon?t.list.form.integral_icon:t.svipImg.integral}}),e("v-uni-view",[t._v("积分"+t._s(t.card.send_integral_num))]),e("v-uni-image",{attrs:{src:"/static/image/icon/arrow-right.png"}})],1):t._e(),t.card.send_balance>0?e("v-uni-view",{staticClass:"gift-item",on:{click:function(i){i=t.$handleEvent(i),t.toBalance(i)}}},[e("v-uni-image",{staticClass:"gift-icon",attrs:{src:"statics/img/app/vip_card/balance.png"!=t.list.form.balance_icon?t.list.form.balance_icon:t.svipImg.balance}}),e("v-uni-view",[t._v("余额"+t._s(t.card.send_balance))]),e("v-uni-image",{attrs:{src:"/static/image/icon/arrow-right.png"}})],1):t._e(),t.card.coupons.length>0?e("v-uni-view",{staticClass:"gift-item",on:{click:function(i){i=t.$handleEvent(i),t.toCoupon(i)}}},[e("v-uni-image",{staticClass:"gift-icon",attrs:{src:"statics/img/app/vip_card/coupon.png"!=t.list.form.coupon_icon?t.list.form.coupon_icon:t.svipImg.coupon}}),e("v-uni-view",[t._v("优惠券"+t._s(t.total_coupon)+"张")]),e("v-uni-image",{attrs:{src:"/static/image/icon/arrow-right.png"}})],1):t._e(),t.card.cards.length>0?e("v-uni-view",{staticClass:"gift-item",on:{click:function(i){i=t.$handleEvent(i),t.toCard(i)}}},[e("v-uni-image",{staticClass:"gift-icon",attrs:{src:"statics/img/app/vip_card/card.png"!=t.list.form.card_icon?t.list.form.card_icon:t.svipImg.card}}),e("v-uni-view",[t._v("卡券"+t._s(t.total_card)+"张")]),e("v-uni-image",{attrs:{src:"/static/image/icon/arrow-right.png"}})],1):t._e(),e("v-uni-view",{staticClass:"dialog-btn",on:{click:function(i){i=t.$handleEvent(i),t.toBack(i)}}},[t._v("我知道了")])],1)],1)],1):t._e(),t.showClose?e("app-close",{attrs:{toBack:!0},on:{update:function(i){i=t.$handleEvent(i),t.getMall(i)}}}):t._e()],1)},n=[];e.d(i,"a",function(){return a}),e.d(i,"b",function(){return n})},ccd1:function(t,i,e){"use strict";var a=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("v-uni-view",[t.modal?e("u-mask",{attrs:{show:2==t.mallStatus.is_open,zIndex:"3000",maskClickAble:!1,zoom:!1}},[e("v-uni-view",{staticClass:"main-center cross-center",staticStyle:{height:"100%",width:"100%"}},[e("v-uni-view",{staticClass:"open-dialog"},[e("v-uni-view",{staticClass:"open-dialog-title"},[t._v("商家已打烊")]),e("v-uni-view",{staticClass:"open-dialog-content"},[t.list.length>0&&"商城"!=t.list?e("v-uni-view",[t._v(t._s(t.list)+"已经打烊")]):t._e(),t.list?t._e():e("v-uni-view",[t._v("您访问的商家已经打烊")]),t.mallStatus.auto_open_text.length>0?e("v-uni-view",[t._v(t._s(t.mallStatus.auto_open_text))]):t._e()],1),e("v-uni-view",{staticClass:"dialog-button",class:t.getTheme+"-m-text "+t.getTheme,on:{click:function(i){i=t.$handleEvent(i),t.toIndex(i)}}},[t._v("继续浏览")])],1)],1)],1):e("v-uni-view",[2==t.mallStatus.is_open?e("v-uni-view",{staticClass:"dir-left-nowrap cross-center close-tip"},[e("v-uni-image",{attrs:{src:"/static/image/icon/be-close.png"}}),e("v-uni-view",{staticClass:"dir-top-nowrap main-center"},[e("v-uni-view",[t._v("商家已打烊")]),t.mallStatus.auto_open_text.length>0?e("v-uni-view",{staticClass:"close-content"},[t._v(t._s(t.mallStatus.auto_open_text))]):t._e()],1)],1):t._e()],1)],1)},n=[];e.d(i,"a",function(){return a}),e.d(i,"b",function(){return n})},d9b6:function(t,i,e){i=t.exports=e("2350")(!1),i.push([t.i,".text-center[data-v-27dcc781]{text-align:center}.font-weight[data-v-27dcc781]{font-weight:700}.page-width[data-v-27dcc781]{width:100%}.goods-hover-class[data-v-27dcc781]{opacity:.9;background-color:#f7f7f7}.background-image[data-v-27dcc781]{background-repeat:no-repeat;background-size:100% 100%;background-position:50%}uni-page-body[data-v-27dcc781]{font-size:%?32?%;background:#f7f7f7}.page-width[data-v-27dcc781]{width:100%}.u-hover-class[data-v-27dcc781]{opacity:.9;background-color:#f7f7f7}.safe-area-inset-bottom[data-v-27dcc781]{padding-bottom:0;padding-bottom:constant(safe-area-inset-bottom);padding-bottom:env(safe-area-inset-bottom)}.head-card[data-v-27dcc781]{height:%?344?%;position:relative}.head-card .card-bottom[data-v-27dcc781]{position:absolute;bottom:0;left:0;height:%?80?%;width:100%}.list[data-v-27dcc781]{width:%?702?%;margin:0 auto;position:relative;margin-top:%?-284?%;z-index:5;background-color:#fff;border-radius:%?15?%;padding-bottom:%?40?%;-webkit-box-shadow:0 0 %?8?% #efefef;box-shadow:0 0 %?8?% #efefef}.list .title[data-v-27dcc781]{width:100%;padding-top:%?40?%;margin-bottom:%?20?%}.list .title .title-text[data-v-27dcc781]{margin:0 %?20?%;font-size:%?32?%;color:#342e25}.list .title uni-image[data-v-27dcc781]{width:%?60?%;height:%?19?%}.list .item[data-v-27dcc781]{min-height:%?120?%;border-top:%?2?% solid #e2e2e2;padding:%?40?% 0;width:%?630?%;margin:0 auto;font-size:%?28?%;color:#342e25}.list .item .label[data-v-27dcc781]{font-size:%?28?%;width:%?260?%;text-align:right;margin-right:%?30?%;color:#999}.list .item .content[data-v-27dcc781]{width:%?340?%}.list .item .content uni-view[data-v-27dcc781]{margin-top:%?20?%}.list .item .content uni-view[data-v-27dcc781]:first-of-type{margin-top:%?2?%}.list .item .content .about[data-v-27dcc781]{font-size:%?20?%;color:#999}.list .item .content .to-detail[data-v-27dcc781]{font-size:24 rpx;margin-top:0;color:#999;width:30%;height:100%}.list .item .content .to-detail uni-view[data-v-27dcc781]{margin-top:0}.list .item .content .to-detail uni-image[data-v-27dcc781]{width:%?12?%;height:%?22?%;margin-left:%?12?%}.bottom-place[data-v-27dcc781]{height:%?160?%}.bottom-place.iphone_x[data-v-27dcc781]{height:%?210?%}.foot[data-v-27dcc781]{position:fixed;z-index:997;bottom:0;left:0;width:100%;height:%?160?%;background-color:#f7f7f7}.foot .foot-button[data-v-27dcc781]{width:%?702?%;margin:%?40?% auto;height:%?80?%;line-height:%?80?%;font-size:%?32?%;text-align:center;border-radius:%?40?%;color:#342e25;background-color:#f3be94}.foot.iphone_x[data-v-27dcc781]{height:%?210?%;padding-bottom:%?50?%}.dialog[data-v-27dcc781]{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.3);z-index:998}.dialog .gift[data-v-27dcc781]{max-height:%?1059?%;width:%?668?%}.dialog .gift .gift-bg[data-v-27dcc781]{height:%?332?%;width:%?668?%}.dialog .gift .gift-list[data-v-27dcc781]{width:%?668?%;background-color:#fff;padding-bottom:%?55?%;padding-top:%?40?%;border-bottom-left-radius:%?20?%;border-bottom-right-radius:%?20?%;margin-top:%?-18?%}.dialog .gift .gift-list .dialog-btn[data-v-27dcc781]{width:%?253?%;height:%?89?%;line-height:%?89?%;margin:%?30?% auto 0;border-radius:%?45?%;text-align:center;background:-webkit-gradient(linear,left top,right top,from(#fbdec7),to(#f3bf95));background:-o-linear-gradient(left,#fbdec7,#f3bf95);background:linear-gradient(90deg,#fbdec7,#f3bf95);color:#fcfcfc}.dialog .gift .gift-list .gift-item[data-v-27dcc781]{position:relative;color:#666;font-size:%?30?%;text-align:center;height:%?112?%;line-height:%?112?%;width:%?532?%;border-radius:%?15?%;border:%?2?% solid #e2e2e2;margin:0 auto %?20?%}.dialog .gift .gift-list .gift-item uni-image[data-v-27dcc781]{position:absolute;bottom:%?44?%;right:%?20?%;width:%?12?%;height:%?22?%}.dialog .gift .gift-list .gift-item .gift-icon[data-v-27dcc781]{height:%?80?%;width:%?80?%;position:absolute;left:%?30?%;top:%?15?%}.buy-form[data-v-27dcc781]{border-radius:%?16?%;overflow:hidden;-webkit-box-shadow:0 0 %?5?% rgba(0,0,0,.025);box-shadow:0 0 %?5?% rgba(0,0,0,.025);margin:%?20?% %?24?% 0 %?24?%}body.?%PAGE?%[data-v-27dcc781]{background:#f7f7f7}",""])},d9cc:function(t,i,e){var a=e("d9b6");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var n=e("4f06").default;n("c440caac",a,!0,{sourceMap:!1,shadowMode:!1})},dcaf:function(t,i,e){"use strict";var a=e("d9cc"),n=e.n(a);n.a},deb5:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var a=e("2f62"),n=c(e("7d93")),o=c(e("f0dd"));function c(t){return t&&t.__esModule?t:{default:t}}function r(t,i){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);i&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),e.push.apply(e,a)}return e}function s(t){for(var i=1;i<arguments.length;i++){var e=null!=arguments[i]?arguments[i]:{};i%2?r(e,!0).forEach(function(i){d(t,i,e[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)):r(e).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(e,i))})}return t}function d(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}var l={data:function(){return{detail:{},list:{form:{card_bg:""}},card:{expire_day:"",type_info:{ignore_goods:[],ignore_cats:[]}},today:"",end_day:"",total_coupon:0,total_card:0,id:0,end_time:"",start_day:"",success:!1,iphone_x:!1,template_message:[],loading:!1,validateResult:{hasError:!1},showClose:!1,is_open:!1}},components:{AppDiyForm:n.default,AppClose:o.default},computed:s({},(0,a.mapState)({svipImg:function(t){return t.mallConfig.__wxapp_img.vip_card}})),methods:{getMall:function(t){this.is_open=1==t.is_open,this.is_open&&this.subscribe()},toDetail:function(){uni.navigateTo({url:"/plugins/vip_card/rights/rights?id="+this.id})},toBack:function(){this.success=!1,uni.navigateBack()},toCoupon:function(){uni.navigateTo({url:"/pages/coupon/index/index"})},toCard:function(){uni.navigateTo({url:"/pages/card/index/index"})},toBalance:function(){uni.navigateTo({url:"/pages/balance/balance"})},toIntegral:function(){uni.navigateTo({url:"/plugins/integral_mall/index/index"})},getSetting:function(){var t=this;t.$showLoading({type:"global",text:"加载中..."}),t.$request({url:t.$api.vip_card.setting}).then(function(i){0==i.code?(t.list=i.data,uni.setNavigationBarTitle({title:"购买"+t.list.name}),t.template_message=i.data.template_message,t.getCard()):uni.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(i){t.$hideLoading()})},getCard:function(){var t=this;t.$request({url:t.$api.vip_card.card_detail,data:{id:this.id}}).then(function(i){if(t.$hideLoading(),0==i.code){t.card=i.data;var e=Date.parse(new Date);t.end_time>0&&(e=Date.parse(new Date(t.end_time)));var a=1e3*(e/1e3+86400*i.data.expire_day),n=new Date(a),o=n.getFullYear(),c=n.getMonth()+1;c>=1&&c<=9&&(c="0"+c);var r=n.getDate();r>=1&&r<=9&&(r="0"+r),t.end_day=o+"/"+c+"/"+r,t.card.coupons.forEach(function(i){t.total_coupon+=+i.send_num}),t.card.cards.forEach(function(i){t.total_card+=+i.send_num})}else uni.showToast({title:i.msg,icon:"none",duration:1e3})}).catch(function(i){t.$hideLoading()})},subscribe:function(){var t=this;if(!this.validateResult.hasError)return!!this.is_open&&void this.$subscribe(this.template_message).then(function(i){t.toSubmit()}).catch(function(i){t.toSubmit()});uni.showToast({title:this.validateResult.errors[0].msg,icon:"none"})},toSubmit:function(){var t=this;if(this.loading)return!1;this.loading=!0,uni.showLoading({mask:!0,title:"购买中..."}),t.$request({url:t.$api.vip_card.order_submit,data:{id:this.id,order_form:JSON.stringify(t.list.order_form)},method:"post"}).then(function(i){0===i.code?t.getPayOrderId(i.data.queue_id,i.data.token):(t.loading=!1,uni.hideLoading(),uni.showModal({title:"提示",content:i.msg,showCancel:!1}))}).catch(function(i){t.loading=!1,uni.hideLoading(),uni.showModal({title:"提示",content:i.errMsg,showCancel:!1})})},handleOrderFormValidate:function(t){var i=t.result;this.validateResult=i,this.showClose=!1},handleGoodsFormInput:function(t){var i=t.data,e=(t.sign,[]);for(var a in i)e[a]={key:i[a].key,label:i[a].name,value:i[a].value,required:i[a].is_required};this.list.order_form=e},getPayOrderId:function(t,i){var e=this;this.$request({url:this.$api.vip_card.pay_data,method:"post",data:{queue_id:t,token:i}}).then(function(a){0===a.code?a.data.retry&&1===a.data.retry?e.getPayDataTimer=setTimeout(function(){e.getPayOrderId(t,i)},1e3):e.pay(a.data.id):(uni.hideLoading(),e.loading=!1,uni.showModal({title:"提示",content:a.msg,showCancel:!1}))}).catch(function(t){e.loading=!1,uni.hideLoading(),uni.showModal({title:"提示",content:t.errMsg,showCancel:!1})})},pay:function(t){var i=this;i.$payment.pay(t).then(function(t){uni.hideLoading(),i.loading=!1,uni.showToast({title:"购买成功",duration:1e3}),i.card.send_integral_num>0||i.card.send_balance>0||i.card.coupons.length>0||i.card.cards.length>0?i.success=!0:setTimeout(function(t){uni.navigateBack()},1e3)}).catch(function(t){uni.hideLoading(),i.loading=!1,uni.showToast({title:"支付失败",icon:"none",duration:1e3})})}},onUnload:function(){clearInterval(this.getPayDataTimer)},onLoad:function(t){var i=this;uni.getSystemInfo({success:function(t){(t.model.indexOf("iPhone X")>-1||t.model.indexOf("iPhone 11")>-1||t.model.indexOf("iPhone11")>-1||t.model.indexOf("iPhone12")>-1)&&(i.iphone_x=!0)}});var e=new Date,a=e.getFullYear(),n=e.getMonth()+1;n>=1&&n<=9&&(n="0"+n);var o=e.getDate();o>=1&&o<=9&&(o="0"+o),this.today=a+"/"+n+"/"+o,this.id=t.id,this.end_time=t.end,this.expire_day=t.expire_day?t.expire_day:0,i.getSetting(t.id)}};i.default=l},f0dd:function(t,i,e){"use strict";e.r(i);var a=e("ccd1"),n=e("5a20");for(var o in n)"default"!==o&&function(t){e.d(i,t,function(){return n[t]})}(o);e("75bd");var c=e("2877"),r=Object(c["a"])(n["default"],a["a"],a["b"],!1,null,"5748c878",null);i["default"]=r.exports}}]);